!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.addMultipleSelect=t()}(this,function(){"use strict";function e(e){return e.normalize("NFD").replace(/[\u0300-\u036f\u1AB0-\u1AFF\u20D0-\u20FF\u1DC0-\u1DFF\uFE20-\uFE2F]/g,"")}return function(t){class s{constructor(e,s){const i=this,l=e.attr("name")||s.name||"";this.options=s,this.$el=e.hide(),this.$label=this.$el.closest("label"),0===this.$label.length&&this.$el.attr("id")&&(this.$label=t(`label[for="${this.$el.attr("id").replace(/:/g,"\\:")}"]`)),this.$parent=t(`<div class="ms-parent ${e.attr("class")||""}" title="${e.attr("title")}"/>`),this.$choice=t(`<button type="button" class="ms-choice">\n                    <span class="placeholder">${this.options.placeholder}</span>\n                    <div></div>\n                </button>`),this.$drop=t(`<div\n                    class="ms-drop ${this.options.position}"\n                    style="width: ${this.options.dropWidth}"}></div>`),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",this.options.width||this.$el.css("width")||this.$el.outerWidth()+20),this.selectAllName=`data-name="selectAll${l}"`,this.selectGroupName=`data-name="selectGroup${l}"`,this.selectItemName=`data-name="selectItem${l}"`,this.options.keepOpen||t(document).click(function(s){t(s.target)[0]!==i.$choice[0]&&t(s.target).parents(".ms-choice")[0]!==i.$choice[0]&&(t(s.target)[0]===i.$drop[0]||t(s.target).parents(".ms-drop")[0]!==i.$drop[0]&&s.target!==e[0])&&i.options.isOpen&&i.close()})}init(){const e=t("<ul></ul>");this.$drop.html(""),this.options.filter&&this.$drop.append('<div class="ms-search">\n                        <input\n                            type="text" autocomplete="off" autocorrect="off"\n                            autocapitilize="off" spellcheck="false" />\n                    </div>'),this.options.selectAll&&!this.options.single&&e.append(`<li class="ms-select-all">\n                        <label>\n                        <input type="checkbox" ${this.selectAllName} />\n${this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1]}\n                        </label>\n                    </li>`),t.each(this.$el.children(),(t,s)=>{e.append(this.optionToHtml(t,s))}),e.append(`<li class="ms-no-results">${this.options.noMatchesFound}</li>`),this.$drop.append(e),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find(`input[${this.selectAllName}]`),this.$selectGroups=this.$drop.find(`input[${this.selectGroupName}]`),this.$selectItems=this.$drop.find(`input[${this.selectItemName}]:enabled`),this.$disableItems=this.$drop.find(`input[${this.selectItemName}]:disabled`),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()}optionToHtml(e,s,i,l){const o=this,n=t(s),h=n.attr("class")||"",c=`title="${n.attr("title")}"`,p=this.options.multiple?"multiple":"",a=this.options.single?"radio":"checkbox";let d;if(n.is("option")){const e=n.val(),s=o.options.textTemplate(n),r=n.prop("selected"),u=`style="${this.options.styler(e)}"`;d=l||n.prop("disabled");const $=t(`<li class="${p} ${h}" ${c} ${u}>\n                    <label class="${d?"disabled":""}">\n                    <input type="${a}"\n                        ${this.selectItemName}\n                        ${r?' checked="checked"':""}\n                        ${d?' disabled="disabled"':""}\n                       data-group="${i}">\n                    <span>${s}</span>\n                    </label>\n                    </li>`);return $.find("input").val(e),$}if(n.is("optgroup")){const s=o.options.labelTemplate(n);i="group_"+e,d=n.prop("disabled");const l=t(`<div>\n                    <li class="group">\n                    <label class="optgroup ${d?"disabled":""}" data-group="${i}">\n${this.options.hideOptgroupCheckboxes||this.options.single?"":`<input type="checkbox" ${this.selectGroupName} ${d?'disabled="disabled"':""}>`}\n                    ${s}\n                    </label>\n                    </li>\n                </div>`);return t.each(n.children(),function(e,t){l.append(o.optionToHtml(e,t,i,d))}),l.html()}}events(){const e=this;function s(t){t.preventDefault(),e[e.options.isOpen?"close":"open"]()}this.$label&&this.$label.off("click").on("click",function(t){"label"===t.target.nodeName.toLowerCase()&&t.target===this&&(s(t),e.options.filter&&e.options.isOpen||e.focus(),t.stopPropagation())}),this.$choice.off("click").on("click",s).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(t){switch(t.which){case 27:e.close(),e.$choice.focus()}}),this.$searchInput.off("keydown").on("keydown",function(t){9===t.keyCode&&t.shiftKey&&e.close()}).off("keyup").on("keyup",function(t){if(e.options.filterAcceptOnEnter&&(13===t.which||32===t.which)&&e.$searchInput.val())return e.$selectAll.click(),e.close(),void e.focus();e.filter()}),this.$selectAll.off("click").on("click",function(){const s=t(this).prop("checked"),i=e.$selectItems.filter(":visible");i.length===e.$selectItems.length?e[s?"checkAll":"uncheckAll"]():(e.$selectGroups.prop("checked",s),i.prop("checked",s),e.options[s?"onCheckAll":"onUncheckAll"](),e.update())}),this.$selectGroups.off("click").on("click",function(){const s=t(this).parent().attr("data-group"),i=e.$selectItems.filter(":visible").filter(`[data-group="${s}"]`),l=i.length!==i.filter(":checked").length;i.prop("checked",l),e.updateSelectAll(),e.update(),e.options.onOptgroupClick({label:t(this).parent().text(),checked:l,children:i.get(),instance:e})}),this.$selectItems.off("click").on("click",function(){if(e.updateSelectAll(),e.update(),e.updateOptGroupSelect(),e.options.onClick({label:t(this).parent().text(),value:t(this).val(),checked:t(this).prop("checked"),instance:e}),e.options.single&&e.options.isOpen&&!e.options.keepOpen&&e.close(),e.options.single){const s=t(this).val();e.$selectItems.filter(function(){return t(this).val()!==s}).each(function(){t(this).prop("checked",!1)}),e.update()}})}open(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop[this.animateMethod("show")](),this.$selectAll.parent().show(),this.$noResults.hide(),this.$el.children().length||(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){const e=this.$drop.offset();this.$drop.appendTo(t(this.options.container)),this.$drop.offset({top:e.top,left:e.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen()}}close(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop[this.animateMethod("hide")](),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()}animateMethod(e){return{show:{fade:"fadeIn",slide:"slideDown"},hide:{fade:"fadeOut",slide:"slideUp"}}[e][this.options.animate]||e}update(e){const s=this.options.displayValues?this.getSelects():this.getSelects("text"),i=this.$choice.find(">span"),l=s.length;0===l?i.addClass("placeholder").html(this.options.placeholder):this.options.allSelected&&l===this.$selectItems.length+this.$disableItems.length?i.removeClass("placeholder").html(this.options.allSelected):this.options.ellipsis&&l>this.options.minimumCountSelected?i.removeClass("placeholder").text(s.slice(0,this.options.minimumCountSelected).join(this.options.delimiter)+"..."):this.options.countSelected&&l>this.options.minimumCountSelected?i.removeClass("placeholder").html(this.options.countSelected.replace("#",s.length).replace("%",this.$selectItems.length+this.$disableItems.length)):i.removeClass("placeholder").text(s.join(this.options.delimiter)),this.options.addTitle&&i.prop("title",this.getSelects("text")),this.$el.val(this.getSelects()).trigger("change"),this.$drop.find("li").removeClass("selected"),this.$drop.find("input:checked").each(function(){t(this).parents("li").first().addClass("selected")}),e||this.$el.trigger("change")}updateSelectAll(e){let t=this.$selectItems;e||(t=t.filter(":visible")),this.$selectAll.prop("checked",t.length&&t.length===t.filter(":checked").length),!e&&this.$selectAll.prop("checked")&&this.options.onCheckAll()}updateOptGroupSelect(){const e=this.$selectItems.filter(":visible");t.each(this.$selectGroups,function(s,i){const l=t(i).parent().attr("data-group"),o=e.filter(`[data-group="${l}"]`);t(i).prop("checked",o.length&&o.length===o.filter(":checked").length)})}getSelects(e){const s=this,i=[];let l=[];return this.$drop.find(`input[${this.selectItemName}]:checked`).each(function(){l.push(t(this).parents("li").first().text()),i.push(t(this).val())}),"text"===e&&this.$selectGroups.length&&(l=[],this.$selectGroups.each(function(){const e=[],i=t(this).parent().text().trim(),o=t(this).parent().data("group"),n=s.$drop.find(`[${s.selectItemName}][data-group="${o}"]`),h=n.filter(":checked");if(h.length){if(e.push("["),e.push(i),n.length>h.length){const s=[];h.each(function(){s.push(t(this).parent().text())}),e.push(": "+s.join(", "))}e.push("]"),l.push(e.join(""))}})),"text"===e?l:i}setSelects(e){this.$selectItems.prop("checked",!1),this.$disableItems.prop("checked",!1),t.each(e,(e,t)=>{this.$selectItems.filter(`[value="${t}"]`).prop("checked",!0),this.$disableItems.filter(`[value="${t}"]`).prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length+this.$disableItems.filter(":checked").length),t.each(this.$selectGroups,(e,s)=>{const i=t(s).parent().attr("data-group"),l=this.$selectItems.filter('[data-group="'+i+'"]');t(s).prop("checked",l.length&&l.length===l.filter(":checked").length)}),this.update()}enable(){this.$choice.removeClass("disabled")}disable(){this.$choice.addClass("disabled")}checkAll(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()}uncheckAll(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()}focus(){this.$choice.focus(),this.options.onFocus()}blur(){this.$choice.blur(),this.options.onBlur()}refresh(){this.init()}destroy(){this.$el.show(),this.$parent.remove(),this.$el.data("multipleSelect",null)}filter(){const s=this,i=this.$searchInput.val().trim().toLowerCase();0===i.length?(this.$selectAll.parent().show(),this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show(),this.$noResults.hide()):(this.$selectItems.each(function(){const s=t(this).parent();s[e(s.text().toLowerCase()).includes(e(i))?"show":"hide"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){const e=t(this).parent(),i=e.attr("data-group");e[s.$selectItems.filter(":visible").filter(`[data-group="${i}"]`).length?"show":"hide"]()}),this.$selectItems.parent().filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll(),this.options.onFilter(i)}}function i(e,i,...l){const o=["getSelects","setSelects","enable","disable","open","close","checkAll","uncheckAll","focus","blur","refresh","destroy"];let n;return this.each(function(){const h=t(this),c=t.extend({},t.fn.multipleSelect.defaults,h.data(),"object"==typeof e&&e);let p=h.data("multipleSelect");if(p||(p=new s(h,c),h.data("multipleSelect",p)),"string"==typeof e){if(!o.includes(e))throw new TypeError("Unknown method: "+e);n=p[e](i,...l)}else p.init(),i&&(n=p[i](...l))}),void 0!==n?n:this}i.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllDelimiter:["[","]"],minimumCountSelected:3,ellipsis:!1,multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,dropWidth:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,animate:"none",displayValues:!1,delimiter:", ",addTitle:!1,filterAcceptOnEnter:!1,hideOptgroupCheckboxes:!1,selectAllText:"Select all",allSelected:"All selected",countSelected:"# of % selected",noMatchesFound:"No matches found",styler:()=>!1,textTemplate:e=>e.html(),labelTemplate:e=>e.attr("label"),onOpen:()=>!1,onClose:()=>!1,onCheckAll:()=>!1,onUncheckAll:()=>!1,onFocus:()=>!1,onBlur:()=>!1,onOptgroupClick:()=>!1,onClick:()=>!1,onFilter:()=>!1},t.fn.multipleSelect=i}}),"undefined"!=typeof jQuery&&addMultipleSelect(jQuery);
