function removeDiacritics(e){return e.normalize("NFD").replace(/[\u0300-\u036f\u1AB0-\u1AFF\u20D0-\u20FF\u1DC0-\u1DFF\uFE20-\uFE2F]/g,"")}function addMultipleSelect(e){class t{constructor(t,s){const i=this,l=t.attr("name")||s.name||"";this.options=s,this.$el=t.hide(),this.$label=this.$el.closest("label"),0===this.$label.length&&this.$el.attr("id")&&(this.$label=e(`label[for="${this.$el.attr("id").replace(/:/g,"\\:")}"]`)),this.$parent=e(`<div class="ms-parent ${t.attr("class")||""}" title="${t.attr("title")}"/>`),this.$choice=e(`<button type="button" class="ms-choice">\n                    <span class="placeholder">${this.options.placeholder}</span>\n                    <div></div>\n                </button>`),this.$drop=e(`<div\n                    class="ms-drop ${this.options.position}"\n                    style="width: ${this.options.dropWidth}"}></div>`),this.$el.after(this.$parent),this.$parent.append(this.$choice),this.$parent.append(this.$drop),this.$el.prop("disabled")&&this.$choice.addClass("disabled"),this.$parent.css("width",this.options.width||this.$el.css("width")||this.$el.outerWidth()+20),this.selectAllName=`data-name="selectAll${l}"`,this.selectGroupName=`data-name="selectGroup${l}"`,this.selectItemName=`data-name="selectItem${l}"`,this.options.keepOpen||e(document).click(function(s){e(s.target)[0]!==i.$choice[0]&&e(s.target).parents(".ms-choice")[0]!==i.$choice[0]&&(e(s.target)[0]===i.$drop[0]||e(s.target).parents(".ms-drop")[0]!==i.$drop[0]&&s.target!==t[0])&&i.options.isOpen&&i.close()})}init(){const t=e("<ul></ul>");this.$drop.html(""),this.options.filter&&this.$drop.append('<div class="ms-search">\n                        <input\n                            type="text" autocomplete="off" autocorrect="off"\n                            autocapitilize="off" spellcheck="false" />\n                    </div>'),this.options.selectAll&&!this.options.single&&t.append(`<li class="ms-select-all">\n                        <label>\n                        <input type="checkbox" ${this.selectAllName} />\n${this.options.selectAllDelimiter[0]+this.options.selectAllText+this.options.selectAllDelimiter[1]}\n                        </label>\n                    </li>`),e.each(this.$el.children(),(e,s)=>{t.append(this.optionToHtml(e,s))}),t.append(`<li class="ms-no-results">${this.options.noMatchesFound}</li>`),this.$drop.append(t),this.$drop.find("ul").css("max-height",this.options.maxHeight+"px"),this.$drop.find(".multiple").css("width",this.options.multipleWidth+"px"),this.$searchInput=this.$drop.find(".ms-search input"),this.$selectAll=this.$drop.find(`input[${this.selectAllName}]`),this.$selectGroups=this.$drop.find(`input[${this.selectGroupName}]`),this.$selectItems=this.$drop.find(`input[${this.selectItemName}]:enabled`),this.$disableItems=this.$drop.find(`input[${this.selectItemName}]:disabled`),this.$noResults=this.$drop.find(".ms-no-results"),this.events(),this.updateSelectAll(!0),this.update(!0),this.options.isOpen&&this.open()}optionToHtml(t,s,i,l){const o=this,n=e(s),h=n.attr("class")||"",c=`title="${n.attr("title")}"`,p=this.options.multiple?"multiple":"",a=this.options.single?"radio":"checkbox";let r;if(n.is("option")){const t=n.val(),s=o.options.textTemplate(n),d=n.prop("selected"),u=`style="${this.options.styler(t)}"`;r=l||n.prop("disabled");const $=e(`<li class="${p} ${h}" ${c} ${u}>\n                    <label class="${r?"disabled":""}">\n                    <input type="${a}"\n                        ${this.selectItemName}\n                        ${d?' checked="checked"':""}\n                        ${r?' disabled="disabled"':""}\n                       data-group="${i}">\n                    <span>${s}</span>\n                    </label>\n                    </li>`);return $.find("input").val(t),$}if(n.is("optgroup")){const s=o.options.labelTemplate(n);i="group_"+t,r=n.prop("disabled");const l=e(`<div>\n                    <li class="group">\n                    <label class="optgroup ${r?"disabled":""}" data-group="${i}">\n${this.options.hideOptgroupCheckboxes||this.options.single?"":`<input type="checkbox" ${this.selectGroupName} ${r?'disabled="disabled"':""}>`}\n                    ${s}\n                    </label>\n                    </li>\n                </div>`);return e.each(n.children(),function(e,t){l.append(o.optionToHtml(e,t,i,r))}),l.html()}}events(){const t=this;function s(e){e.preventDefault(),t[t.options.isOpen?"close":"open"]()}this.$label&&this.$label.off("click").on("click",function(e){"label"===e.target.nodeName.toLowerCase()&&e.target===this&&(s(e),t.options.filter&&t.options.isOpen||t.focus(),e.stopPropagation())}),this.$choice.off("click").on("click",s).off("focus").on("focus",this.options.onFocus).off("blur").on("blur",this.options.onBlur),this.$parent.off("keydown").on("keydown",function(e){switch(e.which){case 27:t.close(),t.$choice.focus()}}),this.$searchInput.off("keydown").on("keydown",function(e){9===e.keyCode&&e.shiftKey&&t.close()}).off("keyup").on("keyup",function(e){if(t.options.filterAcceptOnEnter&&(13===e.which||32===e.which)&&t.$searchInput.val())return t.$selectAll.click(),t.close(),void t.focus();t.filter()}),this.$selectAll.off("click").on("click",function(){const s=e(this).prop("checked"),i=t.$selectItems.filter(":visible");i.length===t.$selectItems.length?t[s?"checkAll":"uncheckAll"]():(t.$selectGroups.prop("checked",s),i.prop("checked",s),t.options[s?"onCheckAll":"onUncheckAll"](),t.update())}),this.$selectGroups.off("click").on("click",function(){const s=e(this).parent().attr("data-group"),i=t.$selectItems.filter(":visible").filter(`[data-group="${s}"]`),l=i.length!==i.filter(":checked").length;i.prop("checked",l),t.updateSelectAll(),t.update(),t.options.onOptgroupClick({label:e(this).parent().text(),checked:l,children:i.get(),instance:t})}),this.$selectItems.off("click").on("click",function(){if(t.updateSelectAll(),t.update(),t.updateOptGroupSelect(),t.options.onClick({label:e(this).parent().text(),value:e(this).val(),checked:e(this).prop("checked"),instance:t}),t.options.single&&t.options.isOpen&&!t.options.keepOpen&&t.close(),t.options.single){const s=e(this).val();t.$selectItems.filter(function(){return e(this).val()!==s}).each(function(){e(this).prop("checked",!1)}),t.update()}})}open(){if(!this.$choice.hasClass("disabled")){if(this.options.isOpen=!0,this.$choice.find(">div").addClass("open"),this.$drop[this.animateMethod("show")](),this.$selectAll.parent().show(),this.$noResults.hide(),this.$el.children().length||(this.$selectAll.parent().hide(),this.$noResults.show()),this.options.container){const t=this.$drop.offset();this.$drop.appendTo(e(this.options.container)),this.$drop.offset({top:t.top,left:t.left})}this.options.filter&&(this.$searchInput.val(""),this.$searchInput.focus(),this.filter()),this.options.onOpen()}}close(){this.options.isOpen=!1,this.$choice.find(">div").removeClass("open"),this.$drop[this.animateMethod("hide")](),this.options.container&&(this.$parent.append(this.$drop),this.$drop.css({top:"auto",left:"auto"})),this.options.onClose()}animateMethod(e){return{show:{fade:"fadeIn",slide:"slideDown"},hide:{fade:"fadeOut",slide:"slideUp"}}[e][this.options.animate]||e}update(t){const s=this.options.displayValues?this.getSelects():this.getSelects("text"),i=this.$choice.find(">span"),l=s.length;0===l?i.addClass("placeholder").html(this.options.placeholder):this.options.allSelected&&l===this.$selectItems.length+this.$disableItems.length?i.removeClass("placeholder").html(this.options.allSelected):this.options.ellipsis&&l>this.options.minimumCountSelected?i.removeClass("placeholder").text(s.slice(0,this.options.minimumCountSelected).join(this.options.delimiter)+"..."):this.options.countSelected&&l>this.options.minimumCountSelected?i.removeClass("placeholder").html(this.options.countSelected.replace("#",s.length).replace("%",this.$selectItems.length+this.$disableItems.length)):i.removeClass("placeholder").text(s.join(this.options.delimiter)),this.options.addTitle&&i.prop("title",this.getSelects("text")),this.$el.val(this.getSelects()).trigger("change"),this.$drop.find("li").removeClass("selected"),this.$drop.find("input:checked").each(function(){e(this).parents("li").first().addClass("selected")}),t||this.$el.trigger("change")}updateSelectAll(e){let t=this.$selectItems;e||(t=t.filter(":visible")),this.$selectAll.prop("checked",t.length&&t.length===t.filter(":checked").length),!e&&this.$selectAll.prop("checked")&&this.options.onCheckAll()}updateOptGroupSelect(){const t=this.$selectItems.filter(":visible");e.each(this.$selectGroups,function(s,i){const l=e(i).parent().attr("data-group"),o=t.filter(`[data-group="${l}"]`);e(i).prop("checked",o.length&&o.length===o.filter(":checked").length)})}getSelects(t){const s=this,i=[];let l=[];return this.$drop.find(`input[${this.selectItemName}]:checked`).each(function(){l.push(e(this).parents("li").first().text()),i.push(e(this).val())}),"text"===t&&this.$selectGroups.length&&(l=[],this.$selectGroups.each(function(){const t=[],i=e(this).parent().text().trim(),o=e(this).parent().data("group"),n=s.$drop.find(`[${s.selectItemName}][data-group="${o}"]`),h=n.filter(":checked");if(h.length){if(t.push("["),t.push(i),n.length>h.length){const s=[];h.each(function(){s.push(e(this).parent().text())}),t.push(": "+s.join(", "))}t.push("]"),l.push(t.join(""))}})),"text"===t?l:i}setSelects(t){this.$selectItems.prop("checked",!1),this.$disableItems.prop("checked",!1),e.each(t,(e,t)=>{this.$selectItems.filter(`[value="${t}"]`).prop("checked",!0),this.$disableItems.filter(`[value="${t}"]`).prop("checked",!0)}),this.$selectAll.prop("checked",this.$selectItems.length===this.$selectItems.filter(":checked").length+this.$disableItems.filter(":checked").length),e.each(this.$selectGroups,(t,s)=>{const i=e(s).parent().attr("data-group"),l=this.$selectItems.filter('[data-group="'+i+'"]');e(s).prop("checked",l.length&&l.length===l.filter(":checked").length)}),this.update()}enable(){this.$choice.removeClass("disabled")}disable(){this.$choice.addClass("disabled")}checkAll(){this.$selectItems.prop("checked",!0),this.$selectGroups.prop("checked",!0),this.$selectAll.prop("checked",!0),this.update(),this.options.onCheckAll()}uncheckAll(){this.$selectItems.prop("checked",!1),this.$selectGroups.prop("checked",!1),this.$selectAll.prop("checked",!1),this.update(),this.options.onUncheckAll()}focus(){this.$choice.focus(),this.options.onFocus()}blur(){this.$choice.blur(),this.options.onBlur()}refresh(){this.init()}destroy(){this.$el.show(),this.$parent.remove(),this.$el.data("multipleSelect",null)}filter(){const t=this,s=this.$searchInput.val().trim().toLowerCase();0===s.length?(this.$selectAll.parent().show(),this.$selectItems.parent().show(),this.$disableItems.parent().show(),this.$selectGroups.parent().show(),this.$noResults.hide()):(this.$selectItems.each(function(){const t=e(this).parent();t[removeDiacritics(t.text().toLowerCase()).includes(removeDiacritics(s))?"show":"hide"]()}),this.$disableItems.parent().hide(),this.$selectGroups.each(function(){const s=e(this).parent(),i=s.attr("data-group");s[t.$selectItems.filter(":visible").filter(`[data-group="${i}"]`).length?"show":"hide"]()}),this.$selectItems.parent().filter(":visible").length?(this.$selectAll.parent().show(),this.$noResults.hide()):(this.$selectAll.parent().hide(),this.$noResults.show())),this.updateOptGroupSelect(),this.updateSelectAll(),this.options.onFilter(s)}}function s(s,i,...l){const o=["getSelects","setSelects","enable","disable","open","close","checkAll","uncheckAll","focus","blur","refresh","destroy"];let n;return this.each(function(){const h=e(this),c=e.extend({},e.fn.multipleSelect.defaults,h.data(),"object"==typeof s&&s);let p=h.data("multipleSelect");if(p||(p=new t(h,c),h.data("multipleSelect",p)),"string"==typeof s){if(!o.includes(s))throw new TypeError("Unknown method: "+s);n=p[s](i,...l)}else p.init(),i&&(n=p[i](...l))}),void 0!==n?n:this}s.defaults={name:"",isOpen:!1,placeholder:"",selectAll:!0,selectAllDelimiter:["[","]"],minimumCountSelected:3,ellipsis:!1,multiple:!1,multipleWidth:80,single:!1,filter:!1,width:void 0,dropWidth:void 0,maxHeight:250,container:null,position:"bottom",keepOpen:!1,animate:"none",displayValues:!1,delimiter:", ",addTitle:!1,filterAcceptOnEnter:!1,hideOptgroupCheckboxes:!1,selectAllText:"Select all",allSelected:"All selected",countSelected:"# of % selected",noMatchesFound:"No matches found",styler:()=>!1,textTemplate:e=>e.html(),labelTemplate:e=>e.attr("label"),onOpen:()=>!1,onClose:()=>!1,onCheckAll:()=>!1,onUncheckAll:()=>!1,onFocus:()=>!1,onBlur:()=>!1,onOptgroupClick:()=>!1,onClick:()=>!1,onFilter:()=>!1},e.fn.multipleSelect=s}export default addMultipleSelect;
